<!-- Форма редактирования конкретного вопроса -->

{% extends "main_base.html" %}
{% load tags %}
{% load static %}
{% block content %}

<div class="left_side">
<fieldset>
        <legend>
            {% include "sub_menu_questions_db.html" with page=request.path %}
        </legend>
    <div class="block-list">
        <form id="question_data" method='post'>
            {% csrf_token %}
            {% for error in question_form.errors.items %}
            <p>{{error}}</p>
            {% endfor %}
            <input type="hidden" name="previous_url" value="{{ previous_url }}">
            <input type="hidden" name="is_active" value="{{ q_object.is_active }}">
            {% if q_object.is_active %}
                <div id='q_status' class="q_active_link_butt">
                    <a href="#" id="{{q_id}}" onclick="inActive(this.id)">
                        ДЕАКТИВИРОВАТЬ ВОПРОС
                    </a>
                </div>
            <hr/>
            {% else %}
                <div class="question-line_inactive">
                    ВОПРОС НЕ АКТИВЕН
                </div>
                <div class="q_active_link_butt">
                    <a href="#" id="{{q_id}}" onclick="inActive(this.id)">
                        АКТИВИРОВАТЬ ВОПРОС
                    </a>
                </div>
            <hr/>
            {% endif %}

            <div class="block_none_light_up">
                <div style="display: inline-block;">
                    {{question_form.them_name.label}}: {{question_form.them_name}}
                </div>
                <div style="display: inline-block;">
                    <span id="ac_type">{{question_form.ac_type.label}}: {{question_form.ac_type}}</span>
                </div>

                    <div style="display: inline-block;">
                        <span>{{question_form.is_for_center}} Для АУЦ NWS</span>
                        <span> {{question_form.is_timelimited}} Ограничение по времени</span>
                    </div>

            </div>

            <hr/>

            <div class="block_none_light_up">
                <div class="new_question-static_sign">
                    <span>{{question_form.question.label}}:</span>
                </div>
                <div class="new_question-input_field">
                    <span><textarea style="font-size: 15px;" id="question" name="question" oninput="autoGrow()">{{question_form.question.value}}</textarea></span>
                </div>
            </div>

            <hr/>

            <div class="block_none_light_up">
                <div class="new_question-static_sign">
                    <span>{{question_form.option_1.label}}:</span>
                </div>
                <div class="new_question-input_field">
                    <span><textarea style="font-size: 15px;" id="option_1" name="option_1" oninput="autoGrow()">{{question_form.option_1.value}}</textarea></span>
                </div>
            </div>

            <div class="block_none_light_up">
                <div class="new_question-static_sign">
                    <span>{{question_form.option_2.label}}:</span>
                </div>
                <div class="new_question-input_field">
                   <span><textarea style="font-size: 15px;" id="option_2" name="option_2" oninput="autoGrow()">{{question_form.option_2.value}}</textarea></span>
                </div>
            </div>

            <div class="block_none_light_up">
                <div class="new_question-static_sign">
                    <span>{{question_form.option_3.label}}:</span>
                </div>
                <div class="new_question-input_field">
                    <span><textarea style="font-size: 15px;" id="option_3" name="option_3" oninput="autoGrow()">{{question_form.option_3.value}}</textarea></span>
                </div>
            </div>
            <div class="block_none_light_up">
                <div class="new_question-static_sign">
                    <span>{{question_form.option_4.label}}:</span>
                </div>
                <div class="new_question-input_field">
                    <span><textarea style="font-size: 15px;" id="option_4" name="option_4" oninput="autoGrow()">{{question_form.option_4.value}}</textarea></span>
                </div>
            </div>
            <div class="block_none_light_up">
                <div class="new_question-static_sign">
                    <span>{{question_form.option_5.label}}:</span>
                </div>
                 <div class="new_question-input_field">
                    <span><textarea style="font-size: 15px;" id="option_5" name="option_5" oninput="autoGrow()">{{question_form.option_5.value}}</textarea></span>
                 </div>
            </div>

            <div class="block_none_light_up">
                <div class="new_question-static_sign">
                    <span>{{question_form.option_6.label}}:</span>
                </div>
                <div class="new_question-input_field">
                    <span><textarea style="font-size: 15px;" id="option_6" name="option_6" oninput="autoGrow()">{{question_form.option_6.value}}</textarea></span>
                </div>
            </div>

            <div class="block_none_light_up">
                <div class="new_question-static_sign">
                    <span>{{question_form.option_7.label}}:</span>
                </div>
                <div class="new_question-input_field">
                    <span><textarea style="font-size: 15px;" id="option_7" name="option_7" oninput="autoGrow()">{{question_form.option_7.value}}</textarea></span>
                </div>
            </div>

            <div class="block_none_light_up">
                <div class="new_question-static_sign">
                    <span>{{question_form.option_8.label}}:</span>
                </div>
                <div class="new_question-input_field">
                   <span><textarea style="font-size: 15px;" id="option_8" name="option_8" oninput="autoGrow()">{{question_form.option_8.value}}</textarea></span>
                </div>
            </div>

            <div class="block_none_light_up">
                <div class="new_question-static_sign">
                    <span>{{question_form.option_9.label}}:</span>
                </div>
                <div class="new_question-input_field">
                    <span><textarea style="font-size: 15px;" id="option_9" name="option_9" oninput="autoGrow()">{{question_form.option_9.value}}</textarea></span>
                </div>
            </div>

            <div class="block_none_light_up">
                <div class="new_question-static_sign">
                    <span>{{question_form.option_10.label}}:</span>
                </div>
                <div class="new_question-input_field">
                    <span><textarea style="font-size: 15px;" id="option_10" name="option_10" oninput="autoGrow()">{{question_form.option_10.value}}</textarea></span>
                </div>
            </div>

            <hr/>

                <p>{{question_form.q_kind.label}}: <input name="q_kind" type="checkbox" id="q_kind" onclick="hideFunc()"></p>
                <p>{{question_form.q_weight.label}}: {{question_form.q_weight}}</p>
                <p id="answer">{{question_form.answer.label}}: <input name="answer" type="number" min="0" max="5" value="{{question_form.answer.value}}"></p>
                <p id="answers">{{question_form.answers.label}}: <input name="answers" type="text" value="{{question_form.answers.value}}"></p>

        </form>

        <form method="post" action="{% url 'quize737:question_del' q_id %}" id="del_question_form">
            {% csrf_token %}
        </form>
        <form method='get' action='{% url "quize737:question_list" %}' id="back_to_list">
        </form>
<!--    Кнопки к формам-->
        <input type="submit" value="Сохранить" form="question_data">
        <span style="color: black;"> | </span>
        <input type="submit" value="Удалить вопрос" form="del_question_form" onclick="return confirm('Удалить Вопрос?') || event.preventDefault()">
        <span style="color: black;"> | </span>
        <input type="submit" value="Вернуться" onClick="javascript:history.go(-1);">
<!--        <br>-->
<!--        <input type="submit" value="Вернуться" form="back_to_list">-->
<!--        <br>-->
<!--        <br>-->
<!--        <input type="submit" value="Вернуться" onClick="javascript:history.go(-1);">-->
    </div>
    {% if not q_object.is_active %}

        <hr/>
        <div class="q_active_link_butt">
            <a href="#" id="{{q_id}}" onclick="inActive(this.id)">
                        АКТИВИРОВАТЬ ВОПРОС
            </a>
        </div>
        <div class="question-line_inactive">
                    ВОПРОС НЕ АКТИВЕН
        </div>
    {% endif %}
</fieldset>
</div>



<p id="demo"></p>

<script src="{% static 'js/jquery-3.7.0.min.js' %}"></script>

<script>
// Активируем/Деактивируем вопрос по нажатию на иконку
    //преобразуем данные формы в JSON
    function getFormData($form){
    var unindexed_array = $form.serializeArray();
    var indexed_array = {};
    $.map(unindexed_array, function(n, i){

        indexed_array[n['name']] = n['value'];

    });
    //console.log(indexed_array);
    return indexed_array;
}
    //Коенкретно сдесь активируем/деактивируем вопрос
    function inActive(clicked_id) {
        //console.log('ID элемента: ' + clicked_id);
        var $form = $("#question_data");
        var data = getFormData($form);
        data['q_switch_id'] = clicked_id;
        $.get("{% url 'quize737:question_list_details' q_id %}", data, function(content){
            console.log(content);
            document.open();
            document.write(content);
            document.close();
            //$('html').html(content);
            //document.innerHTML = content;
            });
        };


//Скрипт меняет размер поля вопроса под фактическое количество символов
var q_text_Length = document.getElementById("question").value.length;
var q_rows_length = 1
if ( q_text_Length > 100 ) { q_rows_length = Math.ceil(q_text_Length/100);
                              q_text_Length = 100 };
var q_field = document.getElementById("question");
q_field.setAttribute("cols", q_text_Length);
q_field.setAttribute("rows", q_rows_length);
//----------------------------------------------------
var option_1_text_Length = document.getElementById("option_1").value.length;
var option_1_rows_length = 1
if ( option_1_text_Length > 100 ) { option_1_rows_length = Math.ceil(option_1_text_Length/100);
                              option_1_text_Length = 100 };
var option_1_field = document.getElementById("option_1");
option_1_field.setAttribute("cols", option_1_text_Length);
option_1_field.setAttribute("rows", option_1_rows_length);

//----------------------------------------------------
var option_2_text_Length = document.getElementById("option_2").value.length;
var option_2_rows_length = 1
if ( option_2_text_Length > 100 ) { option_2_rows_length = Math.ceil(option_2_text_Length/100);
                              option_2_text_Length = 100 };
var option_2_field = document.getElementById("option_2");
option_2_field.setAttribute("cols", option_2_text_Length);
option_2_field.setAttribute("rows", option_2_rows_length);

//----------------------------------------------------
var option_3_text_Length = document.getElementById("option_3").value.length;
var option_3_rows_length = 1
if ( option_3_text_Length > 100 ) { option_3_rows_length = Math.ceil(option_3_text_Length/100);
                              option_3_text_Length = 100 };
var option_3_field = document.getElementById("option_3");
option_3_field.setAttribute("cols", option_3_text_Length);
option_3_field.setAttribute("rows", option_3_rows_length);

//----------------------------------------------------
var option_4_text_Length = document.getElementById("option_4").value.length;
var option_4_rows_length = 1
if ( option_4_text_Length > 100 ) { option_4_rows_length = Math.ceil(option_4_text_Length/100);
                              option_4_text_Length = 100 };
var option_4_field = document.getElementById("option_4");
option_4_field.setAttribute("cols", option_4_text_Length);
option_4_field.setAttribute("rows", option_4_rows_length);

//----------------------------------------------------
var option_5_text_Length = document.getElementById("option_5").value.length;
var option_5_rows_length = 1
if ( option_5_text_Length > 100 ) { option_5_rows_length = Math.ceil(option_5_text_Length/100);
                              option_5_text_Length = 100 };
var option_5_field = document.getElementById("option_5");
option_5_field.setAttribute("cols", option_5_text_Length);
option_5_field.setAttribute("rows", option_5_rows_length);

//----------------------------------------------------
var option_6_text_Length = document.getElementById("option_6").value.length;
var option_6_rows_length = 1
if ( option_6_text_Length > 100 ) { option_6_rows_length = Math.ceil(option_6_text_Length/100);
                              option_6_text_Length = 100 };
var option_6_field = document.getElementById("option_6");
option_6_field.setAttribute("cols", option_6_text_Length);
option_6_field.setAttribute("rows", option_6_rows_length);

//----------------------------------------------------
var option_7_text_Length = document.getElementById("option_7").value.length;
var option_7_rows_length = 1
if ( option_7_text_Length > 100 ) { option_7_rows_length = Math.ceil(option_7_text_Length/100);
                              option_7_text_Length = 100 };
var option_7_field = document.getElementById("option_7");
option_7_field.setAttribute("cols", option_7_text_Length);
option_7_field.setAttribute("rows", option_7_rows_length);

//----------------------------------------------------
var option_8_text_Length = document.getElementById("option_8").value.length;
var option_8_rows_length = 1
if ( option_8_text_Length > 100 ) { option_8_rows_length = Math.ceil(option_8_text_Length/100);
                              option_8_text_Length = 100 };
var option_8_field = document.getElementById("option_8");
option_8_field.setAttribute("cols", option_8_text_Length);
option_8_field.setAttribute("rows", option_8_rows_length);

//----------------------------------------------------
var option_9_text_Length = document.getElementById("option_9").value.length;
var option_9_rows_length = 1
if ( option_9_text_Length > 100 ) { option_9_rows_length = Math.ceil(option_9_text_Length/100);
                              option_9_text_Length = 100 };
var option_9_field = document.getElementById("option_9");
option_9_field.setAttribute("cols", option_9_text_Length);
option_9_field.setAttribute("rows", option_9_rows_length);

//----------------------------------------------------
var option_10_text_Length = document.getElementById("option_10").value.length;
var option_10_rows_length = 1
if ( option_10_text_Length > 100 ) { option_10_rows_length = Math.ceil(option_10_text_Length/100);
                              option_10_text_Length = 100 };
var option_10_field = document.getElementById("option_10");
option_10_field.setAttribute("cols", option_10_text_Length);
option_10_field.setAttribute("rows", option_10_rows_length);



//Скрипт определяет изначальную видимость полей, в зависимости от вида вопроса
var checkBox = document.getElementById("q_kind");
var answer_field = document.getElementById("answer");
var answers_field = document.getElementById("answers");
var checkBox_value = "{{question_form.q_kind.value}}"

if (checkBox_value == "True") {
    checkBox.checked = true; } else {
    checkBox.checked = false;
    }


if (checkBox.checked == true) {
        answers_field.style.display = "block";
        answer_field.style.display = "none"; } else {
        answers_field.style.display = "none";
        answer_field.style.display = "block";
        }


//Функция скрывает или паказывает нужные поля, в зависимости от варианта вопроса
function hideFunc() {
    var checkBox = document.getElementById("q_kind");
    var answer_field = document.getElementById("answer");
    var answers_field = document.getElementById("answers");
    if (checkBox.checked == true){
        answers_field.style.display = "block";
        answer_field.style.display = "none"; } else {
        answers_field.style.display = "none";
        answer_field.style.display = "block";
        }
    }

//Динамическое изменение поля ввода текста вопроса
function autoGrow() {
    var q_text=document.getElementById(event.target.id)
  if (q_text.scrollHeight > q_text.clientHeight) {
    q_text.style.height = `${q_text.scrollHeight}px`;
  }
}


//var box = document.getElementById("q_kind");
//var x = box.getAttribute("checked")
//document.getElementById("demo").innerHTML = "Value: " + checkBox_value + ' ' + x


</script>


{% endblock %}